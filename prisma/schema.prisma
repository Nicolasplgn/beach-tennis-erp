generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
    name    String?  
  leagues   League[]  
}

model League {
  id          String       @id @default(cuid())
  name        String
  adminId     String
  admin       User         @relation(fields: [adminId], references: [id], onDelete: Cascade)
  players     Player[]     // Base Master de Atletas
  tournaments Tournament[] 
  createdAt   DateTime     @default(now())
}

model Tournament {
  id          String    @id @default(cuid())
  name        String
  date        DateTime
  status      String    @default("DRAFT")
  format      String    @default("KNOCKOUT")
  leagueId    String
  league      League    @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  
  // ATENÇÃO: Atletas confirmados NESTE torneio
  participants Player[]  @relation("TournamentParticipants")
  
  teams       Team[]
  matches     Match[]
}

model Player {
  id        String   @id @default(cuid())
  name      String
  nickname  String?
  level     String?  // Agora aceita D, C, B, A, PRO
  leagueId  String
  league    League   @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  
  // Relação com torneios
  tournaments Tournament[] @relation("TournamentParticipants")
  teams       Team[]       @relation("PlayerTeams")
  
  points    Int      @default(0)
  wins      Int      @default(0)
  matches   Int      @default(0)
}


model Team {
  id           String     @id @default(cuid())
  name         String
  group        String?    // A, B (Para fase de grupos)
  
  tournamentId String
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  players      Player[]   @relation("PlayerTeams")
  
  matchesA     Match[]    @relation("TeamA")
  matchesB     Match[]    @relation("TeamB")
  wonMatches   Match[]    @relation("Winner")
}

model Match {
  id           String     @id @default(cuid())
  tournamentId String
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  type         String     @default("KNOCKOUT") // KNOCKOUT, GROUP_STAGE
  round        Int        // Na fase de grupos, representa a "Rodada 1, 2, 3"
  position     Int
  group        String?    // A ou B (Se for fase de grupos)
  
  nextMatchId  String?    
  nextMatch    Match?     @relation("NextMatch", fields: [nextMatchId], references: [id], onDelete: SetNull, onUpdate: NoAction)
  prevMatches  Match[]    @relation("NextMatch")

  teamAId      String?
  teamA        Team?      @relation("TeamA", fields: [teamAId], references: [id])
  
  teamBId      String?
  teamB        Team?      @relation("TeamB", fields: [teamBId], references: [id])
  
  winnerId     String?
  winner       Team?      @relation("Winner", fields: [winnerId], references: [id])

  scoreA       Int?       @default(0)
  scoreB       Int?       @default(0)
  status       String     @default("PENDING")
}